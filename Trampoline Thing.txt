var myGame = new Kiwi.Game();
var myState = new Kiwi.State("myState");
var delta = new Kiwi.Time.MasterClock;
myState.preload = function () {
    Kiwi.State.prototype.preload.call(this);
    this.addSpriteSheet('characterSprite', 'media/character.png', 150, 117);
    this.addImage('background', 'media/jungle.png');
};
myState.create = function () {
    Kiwi.State.prototype.create.call(this);
    this.cam1 = new Kiwi.Camera(myGame, 1, "cam1", 100, 0, 100, 100);
    this.background = new Kiwi.GameObjects.StaticImage(this, this.textures.background, 0, 0);
    this.character = new Kiwi.GameObjects.Sprite(this, this.textures.characterSprite, 350, 330);
    this.collisionBox = new Kiwi.Components.Box(this.character);
    this.vSpeed = 0;
    this.gravity = .1;
    this.leftKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.A);
    this.rightKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.D);
    this.downKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.S);
    this.upKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.W);
    this.jumpKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.V);
    this.rRotKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.Q);
    this.lRotKey = this.game.input.keyboard.addKey(Kiwi.Input.Keycodes.E);
    this.character.animation.add("idleright", [0], 0.1, false);
    this.character.animation.add("crouchright", [1], 0.1, false);
    this.character.animation.add("moveright", [2, 3, 4, 5, 6, 7], 0.1, true);
    this.character.animation.add("idleleft", [8], 0.1, false);
    this.character.animation.add("crouchleft", [9], 0.1, false);
    this.character.animation.add("moveleft", [15, 14, 13, 12, 11, 10], 0.1, true);
    this.facing = "right";
    this.character.animation.play("idleright");
    this.addChild(this.background);
    this.addChild(this.character);
    this.jumped = false;
};
myState.update = function () {
    Kiwi.State.prototype.update.call(this);
        this.character.transform.y += this.vSpeed;
        this.vSpeed += .1;
        if (this.jumpKey.isDown){
            this.vSpeed = -5
        }
    else if (this.lRotKey.isDown&&this.rightKey.isDown){
        this.character.rotation += .1
        this.character.transform.x +=6
   }
    else if (this.rRotKey.isDown&&this.rightKey.isDown){
            this.character.rotation -= .1
            this.character.transform.x +=6
    }
        else if (this.lRotKey.isDown&&this.leftKey.isDown){
        this.character.rotation += .1
        this.character.transform.x -=6
   }
    else if (this.rRotKey.isDown&&this.leftKey.isDown){
            this.character.rotation -= .1
            this.character.transform.x -=6
    }
    else if (this.lRotKey.isDown){
        
            this.character.rotation += .1
   }
    else if (this.rRotKey.isDown){
        
            this.character.rotation -= .1
         
    }
    else if (this.downKey.isDown) {
        if (this.character.animation.currentAnimation.name != ("crouch" + this.facing))
            this.character.animation.play("crouch" + this.facing), console.log(this.game.name);
    }
    else if (this.leftKey.isDown) {
        this.facing = "left";
        this.character.transform.x -= 6, this.cam1.transform.x -= 6;
        if (this.character.animation.currentAnimation.name != "moveleft")
            this.character.animation.play("moveleft"), console.log(delta.idealDelta);
    }
    else if (this.rightKey.isDown) {
        this.facing = "right";
        this.character.transform.x += 6;
        if (this.character.animation.currentAnimation.name != "moveright")
            this.character.animation.play("moveright"), console.log(delta.idealDelta);
    }
  
    else {
        if (this.character.animation.currentAnimation.name != "idle" + this.facing) {
            this.character.animation.play("idle" + this.facing);
        }
    }
};
myGame.states.addState(myState);
myGame.states.switchState("myState");
